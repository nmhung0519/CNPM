<!DOCTYPE html>
<html>
    <head>
        <title>Game 3</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width-device-width, initial-scale = 1.0">
        <link rel="stylesheet" type="text/css" href="style.css">
        <style>
            div.number {
                display:none
            }
            #OK_button {
                height: 40px;
                width: 90px;
                top: 500px;
                left: 445px;
                border-radius: 150px;
                border: 10px solid lawngreen;
                color: white;
                text-align: center;
                justify-content: center;
                align-items: center;
                font-size: 20px;
                display: none;
                opacity: 0.3;
                background: #82B366;
                position: absolute;
            }
            #guide {
                top: 120px;
                left: 100px;
                background: navajowhite;
                text-align: center;
                vertical-align: middle;
                padding-top: 20px;
                padding-bottom: 20px;
                padding-left: 80px;
                padding-right: 80px;
                font-size: 20px;
                border-radius: 20px;
                border: 10px solid green;
                display: none;
                position: absolute;
            }
            #Animation {
                position: relative;
                display: none;
                top: -20px;
                width: 70px; height: 20px;
                background: url('../Picture/arrow6.png');
            }
            img.arrow {
                top: -20px;
                width: 70px;
                height: 20px;
                position: absolute;
                display: none;
            }
            #highlight {
                display: none;
            }
            #container {
                top: 105.333px; 
                left: -425px;
            }
            #game_display {
                top: 300px; 
                opacity: 0.2;
            }
            #grasshopper img {
                margin-top: 0px; 
                margin-left: 0px;
            }
            #dot {
                margin-left: -4px; 
                cursor: default;
            }
        </style>
        <script src="resize.js"></script>
    </head>
    <body onload="fixPosition()">
        <div id="container">
            <div id="back_button" draggable="false">
                <a href="Main.html" draggable="false">< Back</a>
            </div>
            <div id="displayScore">
                <div>
                    <img class ="ball" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_1" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_2" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_3" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_4" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_5" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_6" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_7" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_8" src="../Picture/ball1.png" />
                </div>
            </div>
            <div class="background"></div>
            <div id="guide"></div>
            <div id="game_display">
                <div class="number id_0 id_number">0</div>
                <div class="number id_1">1</div>
                <div class="number id_2">2</div>
                <div class="number id_3">3</div>
                <div class="number id_4">4</div>
                <div class="number id_5 id_number">5</div>
                <div class="number id_6">6</div>
                <div class="number id_7">7</div>
                <div class="number id_8">8</div>
                <div class="number id_9">9</div>
                <div class="number id_10 id_number">10</div>
                <div id="line">
                    <div id="Animation"></div>
                    <div>
                        <img class = "arrow arrow_0" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_1" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_2" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_3" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_4" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_5" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_6" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_7" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_8" img src="../Picture/arrow1.png">
                    </div>

                    <div class="line_background">&#62;</div>
                    <div class="point point_small"></div>
                    <div class="point point_1"></div>
                    <div class="point point_2"></div>
                    <div class="point point_3"></div>
                    <div class="point point_4"></div>
                    <div class="point point_5 point_small"></div>
                    <div class="point point_6"></div>
                    <div class="point point_7"></div>
                    <div class="point point_8"></div>
                    <div class="point point_9"></div>
                    <div class="point point_10 point_small"></div>
                    <div id="highlight"></div>
                    <div id="dot" onmousedown="mousedown(event)">
                        <div id="grasshopper">
                            <img src="../Picture/grasshopper1.png" draggable="false">
                        </div>
                    </div>
                    <div id="box" class="box box_style"></div>
                </div>
            </div>
            <div id="start_button" onclick="start()" onmouseover="over()" onmouseout="out()">
                <div id="start_button_1">
                    <img id="start_img" src="../Picture/Start0.png" width="120px" height="120px" draggable="false">
                </div>
                <script src="mouse_on_startButton.js"></script>
            </div>
            <div id="home_button">
                <p><a href="Main.html"> Go to Lesson </a></p>
            </div>
            <div id="OK_button" onclick="check_answer()">OK</div>
        </div>
        <script>
            var index = 1;
            var guide = document.getElementById("guide");
            var box = document.getElementById("box");
            var number = document.getElementsByClassName("number");
            var grasshopper = document.getElementById("grasshopper");
            var start_button = document.getElementById("start_button");
            var dot = document.getElementById("dot");
            var OK_button = document.getElementById("OK_button");
            var ball = document.getElementsByClassName("ball");
            var highlight = document.getElementById("highlight");
            var Animation = document.getElementById("Animation");
            var arrow = document.getElementsByClassName("arrow");
            var grasshopper_margin = 0;
            var x;
            var score = 0;
            var dot_left = -5;
            var status = 0;
            var canMove = 0;
            var canPress = 0;
            var stage = 0;
            var length = 0;
            var check_correct = 1;
            var question = [4, 2, 5, 8, 3, 9, 6, 1, 7];
            var now_number = 0;
            var highlight_length = 0;
            var highlight_count = 0;
            function start() {
                canMove = 0;
                var count = 0;
                var t = setInterval(show, 20);
                function show() {
                    if (count == 8) {
                        clearInterval(t);
                        start_button.style.display = 'none';
                    }
                    else {
                        count ++;
                        game_display.style.opacity = (count * 0.1) + 0.2;
                        start_button.style.opacity = 1 - (count * 0.1);
                    }
                }
                setTimeout(new_question, 1000);
            }
            function restart() {
                length = 0;
                highlight_count = 0;
                Animation.style.left = 0 + 'px';
                highlight.style.width = '0px';
                clear_arrow();
                game_display.style.opacity = 0.2;
                if (score == 0 ) {
                    index = 1;
                    var t = setInterval(move_back_0, 1);
                    start_button.style.opacity = 1;
                    start_button.style.display = 'block';
                    for (var i = 1; i < 10; i++) number[i].style.display = 'none';
                }
                else if (score < 9){
                    stage = 1;
                    index = question[0];
                    question.shift();
                    question.push(index);
                    OK_button.style.display = 'block';
                    var t = setInterval(move_back_0, 1);
                    start_button.style.opacity = 1;
                    start_button.style.display = 'block';
                    for (var i = 1; i < 10; i++) number[i].style.display = 'none';
                    number[10].style.display = 'block';
                }
                else {
                    document.getElementById("home_button").style.display = 'block';
                }
                function move_back_0() {
                    if (dot_left == -4) clearInterval(t);
                    else {
                        dot_left -= 5;
                        dot.style.left = dot_left + "px";
                        length -= 5;
                        highlight.style.width = length + "px";
                    }
                }
            }
            function new_question() {

                var count = 0;
                if (stage == 0) {
                    if (index < 6) {
                        var t = setInterval(jump, 5);
                        move_highlight(1);
                    }
                    else if (index < 10) {
                        move_highlight(1);
                        make_question();
                    }
                    else {
                        if (check_correct == 1) {
                            score_increase();
                        setTimeout(restart, 100);
                        }
                        else {
                            check_correct = 1;
                            setTimeout(function() {
                                game_display.style.display = 'none';
                                dot_left = -4;
                                dot.style.left = "-4px";
                                length = 0;
                                highlight_count = 0;
                                Animation.style.left = 0 + 'px';
                                highlight.style.width = '0px';
                                clear_arrow();
                                
                                index = 1;
                                for (var i = 1; i < 10; i++) number[i].style.display = 'none';
                            }, 100);
                            setTimeout(function() {game_display.style.display = 'block';}, 300);
                            setTimeout(function () {game_display.style.display = 'block';}, 500);
                            setTimeout(new_question, 1500);
                        }
                    }
                }
                else if (stage == 1) {
                    give_guide("Move the grasshopper to point " + index);
                    setTimeout(make_question, 100);
                }
                function jump() {
                    if (count >= 70) {
                        clearInterval(t);
                        make_question();
                    }
                    else {
                        count += 1;
                        dot_left += 1;
                        dot.style.left = dot_left + "px";
                        if (count <= 35) grasshopper.style.marginTop = - (count) + "px";
                        else grasshopper.style.marginTop = - (70 - count) + "px";
                    }
                }
            }
            function move_highlight(n) {
                Animation.style.width = 0 + 'px';
                Animation.style.length = 20 + 10 * (n - 1) + 'px';
                Animation.style.display = 'block';
                highlight_length = 0;
                var t = setInterval(function() {
                    if (highlight_length == 70 * n) {
                        Animation.style.display = 'none';
                        if(n == 1) arrow[highlight_count].style.display = 'block';
                        highlight_count++;
                        length = highlight_count * 70;
                        Animation.style.left = length + 'px';
                        highlight.style.width = length + 'px';
                        clearInterval(t);
                    }
                    else {
                        highlight_length++;
                        Animation.style.width = highlight_length + "px";
                    }
                }, 5);
            }
            function make_question() {
                if (stage == 0) {
                    if (index < 6) {
                        setTimeout(set_box_block, 500, index);
                        if (index < 3) setTimeout(correct, 1500);
                        else if (index < 6) {
                            setTimeout(set_box_block, 500, index);
                            if (index == 3) setTimeout(function() {give_guide("Write the number");}, 600);
                            setTimeout(canPress = 1, 1000);
                        }
                    }
                    else if (index < 10) {
                        canMove = 1;
                        dot.style.cursor = 'pointer';
                        give_guide("Now you move the grasshopper 1 step forward");
                    }
                    else {
                        restart();
                    }
                }
                else if (stage == 1) {
                    canMove = 1;
                    grasshopper.style.cursor = 'pointer';
                }
                addEventListener('keydown', function(event) {
                    if (canPress == 1 && stage == 0) {
                        if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105)) {
                            var key = event.keyCode - 48;
                            if (key >= 10) key -= 48;
                            if (key == index) {
                                if (box.style.display == "block") {
                                    correct();
                                    canPress = 0;
                                }
                                setTimeout(function() {guide.style.display = 'none';}, 200);
                            }
                            else {
                                box.innerHTML = key + "";
                                box.style.border = '3px solid red';
                                check_correct = 0;
                            }
                        }
                    }
                });
                function correct() {
                    number[index].style.display = 'block';
                    set_box_none();
                    setTimeout(index += 1, 999);
                    setTimeout(new_question, 1000);
                }
            }
            function mousedown(ev) {
                x = ev.x;
                if (canMove == 1) {
                    status = 1;
                    document.getElementById("grasshopper").style.marginTop = "-5px";
                }
                document.addEventListener('mousemove', function (evt) {
                    if (status == 1) {
                        if (now_number == 0) {
                            dot_left = dot_left + event.x - x;
                            x = event.x;
                            if (dot_left < -4) dot.style.left = "-4px";
                            else if (dot_left > 696) dot.style.left = "696px";
                            else dot.style.left = dot_left + "px";
                        }
                        else {
                            grasshopper_margin -= event.x - x;
                            x = event.x;
                            if (grasshopper_margin > dot_left + 4) grasshopper.style.marginLeft = (- (dot + 4)) + 'px';
                            else if (grasshopper_margin < (dot_left + 4 - now_number * 70)) grasshopper.style.marginLeft = (-(dot_left + 4 - now_number*70)) + 'px';
                            else grasshopper.style.marginLeft = (- grasshopper_margin) + "px";
                        }
                    }
                });
            }
            function give_guide(message) {
                guide.innerHTML = message;
                guide.style.display = 'block';
            }
            addEventListener('mouseup', function () {
                if (status == 1) {
                    status = 0;
                    document.getElementById("grasshopper").style.marginTop = '0px';
                    if (now_number == 0) {
                        if (dot_left > 696) {
                            dot_left = 696;
                            if (stage == 1) OK_on();
                        } else if (dot_left < -4) {
                            dot_left = -4;
                            if (stage == 1) OK_off();
                        } else {
                            var tmp = Math.round((dot_left + 4) / 70) * 70 - 4;
                            var change;
                            if (tmp > dot_left) {
                                change = 1;
                            } else change = -1;
                            var t = setInterval(move_to_near, 10);
                            function move_to_near() {
                                if (dot_left == tmp) {
                                    clearInterval(t);
                                    if (stage == 0) check();
                                    else {
                                        if (dot_left == -4) OK_off();
                                        else OK_on();
                                    }
                                } else {
                                    dot_left += change;
                                    dot.style.left = dot_left + "px";
                                }
                            }
                            function check() {
                                if (dot_left + 4 == 70 * index) {
                                    canMove = 0;
                                    dot.style.cursor = "default";
                                    setTimeout(set_box_block, 500, index);
                                    if (stage == 0) setTimeout(function () {
                                        guide.style.display = 'none'
                                    }, 300);
                                    setTimeout(canPress = 1, 1000);
                                }
                            }
                        }
                    }
                    else if (now_number > 0) {
                        if (grasshopper_margin > dot_left + 4) grasshopper_margin = dot_left + 4;
                        else if (grasshopper_margin < (dot_left + 4 - now_number * 70)) {
                            grasshopper_margin = dot_left + 4 - (now_number * 70);
                            console.log(grasshopper_margin);
                            canMove = 0;
                            setTimeout(function() {
                                set_box_block(now_number);
                                canMove = 0;
                                give_guide("Write the number");
                            }, 100);
                            setTimeout(function() {canPress = 1;}, 200);
                        }
                        else {
                            var tmp =  (Math.round(grasshopper_margin / 70)) * 70;
                            var change;
                            if (tmp > grasshopper_margin) change = 1;
                            else change = -1;
                            var t = setInterval(move_to_near, 10);
                            function move_to_near() {
                                if (tmp == grasshopper_margin) {
                                    clearInterval(t);
                                    if (dot_left + 4 == tmp + now_number * 70) {
                                        canMove = 0;
                                        setTimeout(function () {
                                            set_box_block(now_number);
                                        }, 100);
                                        setTimeout(function () {
                                            canPress = 1;
                                            give_guide("Write the number");
                                        }, 200);
                                    }
                                }
                                else {
                                    grasshopper_margin += change;
                                    grasshopper.style.marginLeft = (- grasshopper_margin) + "px";
                                }
                            }
                        }
                    }
                }
            });
            function check_answer() {
                OK_off();
                if (dot_left != -4) {
                    if (dot_left + 4 == index * 70) {
                        canMove = 0;
                        OK_off();
                        number[index].style.display = 'block';
                        setTimeout(move_highlight, 300, index);
                        setTimeout(function() {
                            game_display.style.opacity = 0;
                            guide.style.display = 'none';
                            OK_button.style.opacity = 0;
                            score_increase();
                        }, index * 350 + 1000);
                        setTimeout(restart, index * 350 + 1000);
                    }
                    else try_again();
                }
            }
            function try_again() {
                grasshopper.src = '../Picture/grasshopper2.png';
                dot.style.background = 'red';
                guide.style.display = 'none';
                dot.style.cursor = 'pointer';
                setTimeout(function () {
                    var t = setInterval(function() {
                        if (grasshopper_margin >= (dot_left + 4)) {
                            clearInterval(t);
                            setTimeout(function() {grasshopper.src = '../Picture/grasshopper1.png'}, 100);
                            setTimeout(next_num, 200);
                        }
                        else {
                            grasshopper_margin += 5;
                            grasshopper.style.marginLeft = - grasshopper_margin + "px";
                        }
                    }, 5);
                }, 200);
            }
            function next_num() {
                if (now_number < index) {
                    now_number += 1;
                    move_highlight(1);
                    setTimeout(function () {
                        canMove = 1;
                        give_guide("Move the grasshopper 1 step forward");
                    }, 400);
                }
                else setTimeout(function(){
                    now_number = 0;
                    game_display.style.display = 'none';
                    for (var i = 1; i < 10; i++) number[i].style.display = 'none';
                    OK_button.style.display = 'none';
                    grasshopper_margin = 0;
                    grasshopper.style.marginLeft = "0px";
                    length = 0;
                    highlight_count = 0;
                    Animation.style.left = 0 + 'px';
                    clear_arrow();
                    highlight.style.width = "0px";
                    dot_left = -4;
                    dot.style.left = "-4px";
                    dot.style.background = 'black';
                    setTimeout(function() {
                        game_display.style.display = 'block';
                        OK_button.style.display = 'block';
                        canMove = 1;
                        setTimeout(give_guide, 200, "Move the grasshopper to point " + index);
                    }, 700);
                }, 200);
            }
            addEventListener('keydown', function(event) {
                if (canPress == 1 && stage == 1) {
                    if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105)) {
                        var key = event.keyCode - 48;
                        if (key >= 10) key -= 48;
                        if (key == now_number) {
                            number[now_number].style.display = 'block';
                            canPress = 0;
                            setTimeout(set_box_none, 100);
                            setTimeout(function () {
                                guide.style.display = 'none';
                            }, 200);
                            setTimeout(next_num, 300);
                        } else {
                            box.innerHTML = key + "";
                            box.style.border = '3px solid red';
                        }
                    }
                }
            });
            function set_box_block(number) {
                box.style.left = number * 70 - 15 + "px";
                box.style.display = 'block';
            }
            function set_box_none() {
                canPress = 0;
                box.innerHTML = " ";
                box.style.border = '3px solid gold';
                box.style.display = 'none';
            }
            function OK_on() {
                OK_button.style.opacity = 1;
                OK_button.style.cursor = 'pointer';
            }
            function OK_off() {
                OK_button.style.opacity = 0.3;
                OK_button.style.cursor = 'default';
            }
            function clear_arrow() {
                highlight_count = 0;
                for(var i = 0 ; i < 9 ; i++) {
                    arrow[i].style.display = 'none';
                }
            }
        </script>
        <script src="change_score.js"></script>
    </body>
</html>