<!DOCTYPE html>
<html>
    <head>
        <title>Game 2</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width-device-width, initial-scale = 1.0">
        <link rel="stylesheet" type="text/css" href="style.css">
        <style>
            body {
                background-color: cornflowerblue;
            }
            div.number {
                display: none;
            }
            div.box {
                width: 26px;
                height: 28px;
                top: 35px;
                background: white;
                border-radius: 5px;
                position: absolute;
            }
            #text {
                top: 100px;
                font-size: 40px;
                text-align: center;
                position: absolute;
                display: none;
                font-family: Verdana;
                line-height: 80px;
            }
            #wrong_line {
                width: 40px;
                height: 47px;
                top: -15px;
                left: -23px;
                border-bottom: 2px solid red;
                display:none;
                -webkit-transform:
                        translateY(0px)
                        translateX(0px)
                        rotate(-45deg);
                position: absolute;
            }
            #answer {
                top: 197px;
                left: 650px;
                font-size: 40px;
                font-family: Verdana;
                position: absolute;
            }
            #big_box {
                height: 50px;
                width: 40px;
                top: 195px;
                left: 640px;
                font-size: 40px;
                text-align: center;
                background: white;
                border-radius: 10px;
                border: 3px solid gold;
                display: none;
                position: absolute;
            }
            #dialog {
                padding: 20px;
                top: 470px;
                border-radius: 10px;
                background: ghostwhite;
                border: 3px solid green;
                display: none;
                position: absolute;
            }
            #Animation {
                position: relative;
                display: none;
                top: -20px;
                width: 70px; height: 20px;
                background: url('../Picture/arrow6.png');
            }
            img.arrow {
                top: -20px;
                width: 70px;
                height: 20px;
                position: absolute;
                display: none;
            }
            #highlight {
                display: none;
            }
            #game_display {
                top: 300px; 
                opacity: 0.2;
            }
            #dot {
                left: 630px; 
                margin-left: -4px; 
                cursor: default;
            }
        </style>
        <script src="resize.js"></script>
    </head>
    <body onload="fixPosition()">
        <div id="container">
            <div id="back_button">
                <a href="Main.html" draggable="false">&#60; Back</a> 
            </div>
            <div id="displayScore">
                <div>
                    <img class ="ball" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_1" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_2" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_3" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_4" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_5" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_6" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_7" src="../Picture/ball1.png" />
                </div>
                <div>
                    <img class ="ball ball_8" src="../Picture/ball1.png" />
                </div>
            </div>
            <span id="text">At what point on the number line is the grasshopper?</span>
            <div id="answer"></div>
            <div id="wrong_line"></div>
            <div id="big_box"></div>
            <div class="background"></div>
            <div id="game_display">
                <div class="number id_0 id_number">0</div>
                <div class="number id_1">1</div>
                <div class="number id_2">2</div>
                <div class="number id_3">3</div>
                <div class="number id_4">4</div>
                <div class="number id_5 id_number">5</div>
                <div class="number id_6">6</div>
                <div class="number id_7">7</div>
                <div class="number id_8">8</div>
                <div class="number id_9">9</div>
                <div class="number id_10 id_number">10</div>
                <div id="line">
                    <div id="Animation"></div>
                    <div>
                        <img class = "arrow arrow_0" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_1" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_2" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_3" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_4" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_5" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_6" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_7" img src="../Picture/arrow1.png">
                    </div>
                    <div>
                        <img class = "arrow arrow_8" img src="../Picture/arrow1.png">
                    </div>
                    
                    <div class="line_background">&#62;</div>
                    <div class="point point_small"></div>
                    <div class="point point_1"></div>
                    <div class="point point_2"></div>
                    <div class="point point_3"></div>
                    <div class="point point_4"></div>
                    <div class="point point_5 point_small"></div>
                    <div class="point point_6"></div>
                    <div class="point point_7"></div>
                    <div class="point point_8"></div>
                    <div class="point point_9"></div>
                    <div class="point point_10 point_small"></div>
                    <div id="highlight"></div>
                    <div id="dot">
                        <div id="grasshopper">
                            <img src="../Picture/grasshopper1.png" draggable="false">
                        </div>
                    </div>
                    <div id="box" class="box box_style"></div>
                </div>
            </div>
            <div id="dialog"></div>
            <div id="start_button" onclick="start()" onmouseover="over()" onmouseout="out()">
                <div id="start_button_1">
                    <img id = "start_img" src="../Picture/Start0.png" width="120px" height="120px" draggable="false">
                </div>
                <script src="mouse_on_startButton.js"></script>
            </div>
            <div id="home_button">
                <p><a href="Main.html"> Go to Lesson </a></p>
            </div>

        </div>
        <script>
            var start_button = document.getElementById("start_button");
            var game_display = document.getElementById("game_display");
            var dot = document.getElementById("dot");
            var number = document.getElementsByClassName("number");
            var box = document.getElementById("box");
            var ball = document.getElementsByClassName("ball");
            var answer = document.getElementById("answer");
            var text = document.getElementById("text");
            var big_box = document.getElementById("big_box");
            var wrong_line = document.getElementById("wrong_line");
            var dialog = document.getElementById("dialog");
            var Animation = document.getElementById("Animation");
            var arrow = document.getElementsByClassName("arrow");
            var score = 0;
            var index = 0;
            var canPress = 0;
            var length = 0;
            var wrong = 0;
            var highlight_length = 0;
            var count = 0;
            var highlight_count = 0;
            var question1 = [2, 1, 5, 3, 4];
            var question2 = [4, 6, 2, 8, 3, 9, 1, 5, 7];
            function start() {
                var t = setInterval(show, 20);
                var count = 0;
                function show() {
                    if (count == 8) {
                        clearInterval(t);
                        start_button.style.display = 'none';
                        setTimeout(function() {
                            if (score == 0) next_question();
                            else {
                                text.style.display = 'block';
                                big_box.style.display = 'block';
                                canPress = 1;
                            }
                        }, 200);
                    }
                    else {
                        count ++;
                        game_display.style.opacity = (count * 0.1) + 0.2;
                        start_button.style.opacity = 1 - (count * 0.1);
                    }
                }
            }
            function guide() {
                move_highlight(1);
                setTimeout(function() {
                    set_box_block(index + 1);
                    setTimeout(function() {
                        if (index < 2) {
                            setTimeout(function (){
                                set_box_none(index += 1);
                                number[index].style.display = 'block';
                            }, 500)
                            setTimeout(guide, 1000);
                        }
                        else {
                            if (index == 2) {
                                dialog.innerText = "Write the number";
                                dialog.style.marginLeft = index * 70 + 180 + 'px';
                                dialog.style.display = 'block';
                            }
                            canPress = 1;
                            index += 1;
                        }
                    }, 100);
                }, 450);
            }
            addEventListener('keydown', function(ev) {
                if ((ev.keyCode >= 48 && ev.keyCode <= 57) || (ev.keyCode >= 96 && ev.keyCode <= 105)) {
                    var key = ev.keyCode - 48;
                    if (key > 10) key -= 48;
                    if (canPress == 1) {
                        canPress = 0;
                        if (score <= 0) {
                            if (key == index) {
                                number[index].style.display = 'block';
                                setTimeout(function() {
                                    set_box_none();
                                    dialog.style.display = 'none';
                                }, 100);
                                setTimeout(function() {
                                    if (index == 9) {
                                        text.style.display = 'block';
                                        big_box.innerText = "";
                                        big_box.style.display = 'block';
                                        canPress = 3;
                                    }
                                    else guide();
                                }, 500);
                            }
                            else {
                                box.style.border = '3px solid red';
                                box.innerHTML = key + "";
                                score = -1;
                                canPress = 1;
                                dialog.innerText = "After " + (index - 1) + " comes " + index;
                                dialog.style.marginLeft = index * 70 + 90 + 'px';
                                dialog.style.display = 'block';
                            }
                        }
                        else {
                            answer.style.top = '197px';
                            answer.innerHTML = key + "";
                            answer.style.display = 'block';
                            big_box.style.display = 'none';
                            dialog.style.display = 'none';
                            if (key == index) {
                                setTimeout(function() {
                                    text.style.display = 'none';
                                    game_display.style.display = 'none';
                                    answer.style.display = 'none';
                                    if (length == 0) setTimeout(score_increase, 300);
                                    if (score == 4) restart();
                                    else {
                                        setTimeout(function () {
                                            if (score < 9) {
                                                next_question();
                                                clear();
                                                game_display.style.display = 'block';
                                                setTimeout(function () {
                                                    text.style.display = 'block';
                                                    big_box.style.display = 'block';
                                                    canPress = 1;
                                                }, 100);
                                            } else {
                                                game_display.style.opacity = 0.2;
                                                document.getElementById("home_button").style.display = 'block';
                                            }
                                        }, 800);
                                    }
                                }, 800);
                            }
                            else {
                                if (score%4 != 1) score_decrease();
                                answer.appendChild(wrong_line);
                                wrong_line.style.display = 'block';
                                try_again();
                            }
                        }
                    }
                    else if (canPress == 2) {
                        canPress = 0;
                        if (key == index) {
                            number[index].style.display = 'block';
                            set_box_none();
                            setTimeout(function () {
                                answer.style.top = '150px';
                                big_box.style.display = 'block';
                                canPress = 1;
                            }, 200);
                        }
                        else {
                            if (wrong == 0) wrong = 1;
                            try_again();
                        }
                    }
                    else if (canPress == 3) {
                        canPress = 0;
                        if (key == index) {
                            answer.innerText = index + "";
                            answer.style.display = 'block';
                            big_box.style.display = 'none';
                            dialog.style.display = 'none';
                            setTimeout(function() {
                                if (score == 0) {
                                    setTimeout(score_increase, 300);
                                    restart();
                                }
                                else {
                                    score = 0;
                                    length = 0;
                                    highlight_count = 0;
                                    Animation.style.left = 0 + 'px';
                                    box.style.display = 'none';
                                    highlight.style.width = '0px';
                                    clear_arrow();
                                    text.style.display = 'none';
                                    answer.style.display = 'none';
                                    highlight.style.width = "0px";
                                    for (var i = 1; i < 10; i++) number[i].style.display = 'none';
                                    index = 0;
                                    setTimeout(guide, 300);
                                }
                            }, 1000);
                        }
                        else {
                            score = -1;
                            big_box.style.color = 'red';
                            big_box.innerText = key + "";
                            setTimeout(function() {
                                var count = 0;
                                var t = setInterval(function () {
                                    if (count == 210) {
                                        clearInterval(t);
                                        canPress = 3;
                                        dialog.innerText = "Look where on the line the grasshopper has jumped to!";
                                        dialog.style.marginLeft = "400px";
                                        dialog.style.display = 'block';
                                    } else {
                                        count++;
                                        var tmp = count % 70;
                                        if (tmp > 35) tmp = 70 - tmp;
                                        grasshopper.style.marginTop = -tmp + "px";
                                    }
                                }, 10);
                            }, 1000);
                        }
                    }
                }
            });
            function restart() {
                length = 0;
                highlight_count = 0;
                Animation.style.left = 0 + 'px';
                box.style.display = 'none';
                highlight.style.width = '0px';
                clear_arrow();
                setTimeout(function () {
                    game_display.style.display = 'none';
                    text.style.display = 'none';
                    answer.style.display = 'none';
                }, 300);
                setTimeout(function () {
                    clear();
                    start_button.style.opacity = 1;
                    game_display.style.opacity = 0.2;
                    game_display.style.display = 'block';
                    start_button.style.display = 'block';
                    next_question();
                }, 800);
            }
            function set_box_block(n) {
                if (n < 10) {
                    box.style.left = n * 70 + "px";
                    box.style.display = 'block';
                }
                else {
                    box.style.display = 'block';
                    setTimeout(function() {
                        canPress = 1;
                    }, 100);
                }
            }
            function try_again() {
                length = 0;
                highlight_count = 0;
                Animation.style.left = 0 + 'px';
                box.style.display = 'none';
                highlight.style.width = '0px';
                clear_arrow();
                for (var i = 1; i < 10; i++) number[i].style.display = 'none';
                setTimeout(function() {
                    dialog.innerText = "Let's count";
                    dialog.style.marginLeft = "110px";
                    dialog.style.display = 'block';
                }, 400);
                var t = setInterval(function() {
                    if (length == index * 70) {
                        clearInterval(t);
                        canPress = 2;
                        set_box_block(index);
                    }
                    else {
                        move_highlight(1);
                        setTimeout(function () {
                            if (length / 70 < index) {
                                if (wrong == 1) number[length / 70].style.display = 'block';
                            }
                            else {
                                    set_box_block(index);
                                    dialog.innerText = "Write the number";
                                    dialog.style.marginLeft = index * 70 + 110 + "px";
                            }
                        }, 500);
                    }
                }, 1500);
            }
            function set_box_none() {
                box.style.display = 'none';
                box.innerHTML = "";
                box.style.border = '3px solid gold';
            }
            function next_question() {
                length = 0;
                highlight_count = 0;
                Animation.style.left = 0 + 'px';
                box.style.display = 'none';
                highlight.style.width = '0px';
                clear_arrow();
                if (score == 0) guide();
                else if (score < 5) {
                    index = question1[0];
                    question1.shift();
                    question1.push(index);
                    set_dot(index);
                }
                else if (score < 9) {
                    index = question2[0];
                    question2.shift();
                    question2.push(index);
                    set_dot(index);
                }
            }
            function move_highlight(n) {
                Animation.style.width = 0 + 'px';
                Animation.style.display = 'block';
                highlight_length = 0;
                var t = setInterval(function() {
                    if (highlight_length == 70) {
                        Animation.style.display = 'none';
                        arrow[highlight_count].style.display = 'block';
                        highlight_count++;
                        length = highlight_count * 70;
                        Animation.style.left = length + 'px';
                        highlight.style.width = length + 'px';
                        clearInterval(t);
                    }
                    else {
                        highlight_length++;
                        Animation.style.width = highlight_length + "px";
                    }
                }, 5);
            }
            function set_dot(n) {
                dot.style.left = n * 70 + "px";
            }
            function clear_arrow() {
                highlight_count = 0;
                for(var i = 0 ; i < 9 ; i++) {
                    arrow[i].style.display = 'none';
                }
            }
            function clear() {
                length = 0;
                highlight.style.width = 0;
                clear_arrow();
                for (var i = 1; i < 10; i++) number[i].style.display = 'none';
            }
        </script>
        <script src="change_score.js"></script>
    </body>
</html>
